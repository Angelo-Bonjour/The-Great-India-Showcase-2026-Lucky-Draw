
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grand Lucky Draw</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>body{margin:0;font-family:Arial,sans-serif;background:#002f61;color:white;display:flex;flex-direction:column;align-items:center}h1{margin-top:20px}#controls{margin:20px}button,label{cursor:pointer;padding:10px 15px;margin:5px;font-size:16px;border:none;background:#ffcc00;color:#000;border-radius:5px}#box-container{position:relative;width:500px;height:350px;background:#0a3e80;border:5px solid #fff;border-radius:10px;overflow:hidden;margin-top:30px}#lid{position:absolute;top:-60px;left:0;width:100%;height:80px;background:#0d4c9a;border-bottom:4px solid #f00;transition:transform 1s ease-out;z-index:10}.lid-open{transform:translateY(-120px) rotate(-15deg)}#entries{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;padding:10px}.entry{padding:10px;background:rgba(255,255,255,0.2);border-radius:5px;text-align:center;animation:slowBlink 2s infinite}@keyframes slowBlink{0%,100%{opacity:1}50%{opacity:.4}}.shuffle{animation:shuffleAnim .2s infinite}@keyframes shuffleAnim{from{transform:translate(0,0)}to{transform:translate(5px,-5px)}}#countdown{position:fixed;top:40%;font-size:80px;display:none}#winners{margin-top:40px;width:80%;background:rgba(255,255,255,.1);padding:15px;border-radius:10px}
</style>
</head>
<body>
<h1>Grand Lucky Draw</h1>
<div id="controls"> <button onclick="refreshParticipants()">Refresh Participant List</button> <label><input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()"> Auto-Refresh (10s)</label> <button onclick="startDraw()">Start Draw</button> </div>
<div id="countdown"></div>
<div id="box-container"><div id="lid"></div><div id="entries">Loading participants...</div></div>
<div id="winners"><h2>Past Winners</h2><ul id="winnerList"></ul><button onclick="resetDraw()">Reset Draw</button></div>
<audio id="drum" src="https://www.soundjay.com/human/sounds/drum-roll-01.mp3"></audio>
<script>
let participants=[];let activePool=[];let winners=[];let autoRefreshTimer=null;
const googleSheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vR9EzQVA4kCkKxyzpQ2S61wrHce8ohaH7v_QvgPzfLqNMkghG3O-_JGYQBVcUmE0-Y-vsKio3pnTeh5/pub?output=csv";
async function fetchParticipants(){const res=await fetch(googleSheetURL);const text=await res.text();const rows=text.split("
").slice(1);participants=rows.map(r=>r.split(",")).filter(c=>c.length>=2).map(c=>c[0].trim()+" ("+c[1].trim()+")");activePool=participants.filter(p=>!winners.includes(p));displayEntries();}
function displayEntries(){document.getElementById("entries").innerHTML=activePool.map(p=>`<div class='entry'>${p}</div>`).join("");}
function refreshParticipants(){fetchParticipants();}
function toggleAutoRefresh(){const check=document.getElementById("autoRefresh");if(check.checked){autoRefreshTimer=setInterval(fetchParticipants,10000);}else{clearInterval(autoRefreshTimer);}}
function showCountdown(seconds){return new Promise(resolve=>{const cd=document.getElementById("countdown");cd.style.display="block";let current=seconds;cd.innerText=current;const timer=setInterval(()=>{current--;cd.innerText=current;if(current===0){clearInterval(timer);cd.style.display="none";resolve();}},1000);});}
async function startDraw(){if(activePool.length===0){alert("No participants left!");return;}const lid=document.getElementById("lid");lid.classList.add("lid-open");await showCountdown(3);document.getElementById("drum").play();document.querySelectorAll(".entry").forEach(e=>e.classList.add("shuffle"));await new Promise(r=>setTimeout(r,5000));document.querySelectorAll(".entry").forEach(e=>e.classList.remove("shuffle"));const winner=activePool[Math.floor(Math.random()*activePool.length)];winners.push(winner);activePool=activePool.filter(p=>p!==winner);confetti({particleCount:500,spread:120,origin:{y:0.6}});alert("ðŸŽ‰ Winner: "+winner+" ðŸŽ‰");updateWinnerList();displayEntries();}
function updateWinnerList(){document.getElementById("winnerList").innerHTML=winners.map(w=>`<li>${w}</li>`).join("");}
function resetDraw(){winners=[];activePool=participants.slice();updateWinnerList();displayEntries();document.getElementById("lid").classList.remove("lid-open");}
fetchParticipants();
</script>
</body>
</html>
